---
type: specs.openrewrite.org/v1beta/recipe
name: com.example.FixKubernetesManifests
displayName: Fix Kubernetes manifest selectors
description: Updates Service selectors to match Deployment labels
recipeList:
  - org.openrewrite.yaml.ChangePropertyValue:
      propertyKey: spec.selector.app
      newValue: hello-kubernetes
      oldValue: goodbye-kubernetes
      filePattern: "{{ targetDirectory }}/manifests.yaml"

#  - org.openrewrite.yaml.ChangePropertyValue:
#      propertyKey: spec.replicas
#      newValue: "557$1"
#      oldValue: "(3)"
#      regex: true
#      filePattern: "{{ targetDirectory }}/manifests.yaml"

  - com.anacoders.cookbook.yaml.ChangeYamlPropertyConditionally:
      conditions: []
      targetJsonPath: spec.replicas
      oldValuePattern: "3"
      newValue: "555"
      filePattern: "{{ targetDirectory }}/manifests.yaml"