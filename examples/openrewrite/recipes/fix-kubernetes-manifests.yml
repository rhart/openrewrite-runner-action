---
type: specs.openrewrite.org/v1beta/recipe
name: com.example.FixKubernetesManifests
displayName: Fix Kubernetes manifest selectors
description: Updates Service selectors to match Deployment labels
recipeList:
  - org.openrewrite.yaml.ChangePropertyValue:
      propertyKey: spec.selector.app
      newValue: hello-kubernetes
      oldValue: goodbye-kubernetes
      filePattern: "{{ targetDirectory }}/manifests.yaml"

  - com.anacoders.cookbook.yaml.ChangeYamlPropertyConditionally:
      conditions:
        - jsonPath: $.kind
          value: Deployment
        - jsonPath: $.metadata.name
          value: hello-kubernetes
      targetJsonPath: $.spec.selector.matchLabels.foo
      oldValuePattern: "(.*-)[0-9]+\\.[0-9]+(-.*)"
      newValue: "$15.4$2"
      filePattern: "{{ targetDirectory }}/manifests.yaml"