---
type: specs.openrewrite.org/v1beta/recipe
name: com.example.FixKubernetesManifests
displayName: Fix Kubernetes manifest selectors
description: Updates Service selectors to match Deployment labels
recipeList:
  - org.openrewrite.yaml.ChangePropertyValue:
      propertyKey: spec.selector.app
      newValue: hello-kubernetes
      oldValue: goodbye-kubernetes
      filePattern: "examples/openrewrite/yaml/project-blue/manifests.yaml"

  - com.anacoders.cookbook.CreateYamlFilesByPattern:
      filePattern: "examples/openrewrite/yaml/project-blue/contour.yaml"
      fileContents: |
        apiVersion: kustomize.toolkit.fluxcd.io/v1
        kind: Kustomization
        metadata:
          name: contour
          namespace: flux-system
        spec:
          interval: 10m0s
          dependsOn:
            - name: crds
            - name: infrastructure
          sourceRef:
            kind: GitRepository
            name: flux-system
          path: ./infrastructure/base/contour/prod
          prune: true
          postBuild:
            substitute:
              additionalTags: gradle-environment=${environment},gradle-owner=dv-infrastructure-team,gradle-iac-tool=k8s,gradle-cost-center=2200,gradle-tagging-version=2,gradle-application=contour