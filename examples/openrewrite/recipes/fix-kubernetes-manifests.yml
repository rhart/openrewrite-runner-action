---
type: specs.openrewrite.org/v1beta/recipe
name: com.example.FixKubernetesManifests
displayName: Fix Kubernetes manifest selectors
description: Updates Service selectors to match Deployment labels
recipeList:
  - org.openrewrite.yaml.ChangePropertyValue:
      propertyKey: spec.selector.app
      newValue: hello-kubernetes
      oldValue: goodbye-kubernetes
      filePattern: "examples/openrewrite/yaml/project-blue/manifests.yaml"

  - com.anacoders.cookbook.CreateYamlFilesByPattern:
      filePattern: "examples/openrewrite/yaml/project-blue/contour.yaml"
      fileContents: "apiVersion: kustomize.toolkit.fluxcd.io/v1\n
kind: Kustomization\n
metadata:\n
  name: contour\n
  namespace: flux-system\n
spec:\n
  interval: 10m0s\n
  dependsOn:\n
    - name: crds\n
    - name: infrastructure\n
  sourceRef:\n
    kind: GitRepository\n
    name: flux-system\n
  path: ./infrastructure/base/contour/prod\n
  prune: true\n
  postBuild:\n
    substitute:\n
      additionalTags: gradle-environment=\${environment:=unset},gradle-owner=dv-infrastructure-team,gradle-iac-tool=k8s,gradle-cost-center=2200,gradle-tagging-version=2,gradle-application=contour"