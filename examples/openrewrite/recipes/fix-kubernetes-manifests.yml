---
type: specs.openrewrite.org/v1beta/recipe
name: com.example.FixKubernetesManifests
displayName: Fix Kubernetes manifest selectors
description: Updates Service selectors to match Deployment labels
recipeList:
  - org.openrewrite.yaml.ChangePropertyValue:
      propertyKey: spec.selector.app
      newValue: hello-kubernetes
      oldValue: goodbye-kubernetes
      filePattern: "{{ targetDirectory }}/manifests.yaml"

#  - org.openrewrite.yaml.ChangePropertyValue:
#      propertyKey: spec.replicas
#      newValue: "557$1"
#      oldValue: "(3)"
#      regex: true
#      filePattern: "{{ targetDirectory }}/manifests.yaml"

  - com.anacoders.cookbook.yaml.ChangeYamlPropertyConditionally:
      conditions:
        - key: kind
          value: Deployment
        - key: metadata.name
          value: hello-kubernetes
      propertyKey: spec.replicas
      newValue: "117$1"
      oldValue: "(3)"
      regex: true
      filePattern: "{{ targetDirectory }}/manifests.yaml"